---
title: "Strukturera Din Tillväxt"
description: "Omfattande styrdokument för InnerJourney-projektet, som täcker vision, projektbeskrivning, arkitektur, utvecklingsprocess, databasstruktur och projekthantering."
slug: strukturera-din-tillvxt
sidebar_label: "Strukturera Din Tillväxt"
sidebar_position: 10
tags:
  - innerjourney
  - styrdokument
  - arkitektur
  - projektledning
  - firestore
---

# Strukturera Din Tillväxt 🧭

Detta dokument samlar styrande information för InnerJourney-projektet, från den grundläggande visionen till tekniska detaljer och arbetsmetoder.

## Visionär Grund: Varför Vi Finns 🌱

Detta avsnitt utgör en levande grund för *Inner Journeys* vision, värderingar och väg framåt, med rötter i *Rising Beyond*.

*(Baserat på innehåll från `2025-04-01-visionar-grund.md`)*

### Introduktion: Historien Bakom

För många år sedan satte sig två vänner, Joel Kvarnsmyr och Ulrika af Klint, ner med en gemensam längtan: att skapa en värld där hjärtats intelligens kunde överbrygga splittring och väcka en hållbar framtid. Ur de samtalen föddes *Rising Beyond* – en vision om empati, kärlek och transformation som sprider sig som ringar på vattnet. 💧

Idag lever den drömmen vidare i *Inner Journey*. Detta dokument, *Visionär Grund*, är vår kompass – en påminnelse om varför vi gör det här och hur vi vill forma framtiden.

### Vision: En Värld av Enhet 🌍

Vi ser en värld där:

*   ❤️ Människor lever från hjärtats visdom och känner en djup samhörighet med varandra och planeten.
*   ✨ Kärlek och empati blir en viral kraft som driver hållbar förändring.
*   🤝 Individer, organisationer och samhällen blomstrar genom autenticitet och samarbete.

*Inner Journey* är verktyget för att göra detta möjligt – en inre resa som skapar yttre vågor.

### Syfte: Vad Vi Strävar Efter 🎯

Vi finns för att:

*   🧠 Väcka hjärtats intelligens och medvetande hos människor över hela världen.
*   🛠️ Erbjuda verktyg som gör personlig och kollektiv transformation enkel, tillgänglig och meningsfull.
*   🌱 Bygga broar mellan det inre och det yttre – för en friskare planet och ett bättre liv för kommande generationer.

Med rötterna i *Rising Beyond* strävar vi efter en radikal förändring som börjar i hjärtat och når globalt.

### Värderingar: Vad Vi Står För 🛡️

Våra kärnvärderingar är:

1.  🌐 **Enhet** – Allt hänger samman, och vi agerar från den insikten.
2.  ❤️ **Hjärtintelligens** – Vi litar på hjärtats visdom bortom intellektets gränser.
3.  ✨ **Autenticitet** – Vi uppmuntrar äkthet i varje steg av resan.
4.  🤗 **Medkänsla** – Kärlek och empati är drivkraften i allt vi gör.
5.  🌳 **Hållbarhet** – Vi bygger för framtiden, inte bara för idag.

Dessa värderingar är vår ryggrad, hämtade från drömmen om *Rising Beyond* och levandegjorda i *Inner Journey*.

### Metod: Hur Vi Gör Det 🛠️

*Inner Journey* förverkligar den *Visionära Grunden* genom att kombinera:

*   🧘 **Guidad Meditation & Reflektion:** Kopplar människor till deras inre visdom och en känsla av enhet.
*   📱 **Tillgängliga Verktyg:** Digitala lösningar (`PWA`, `AI`) som gör transformation enkelt för alla – oavsett var, när eller vem.
*   🧑‍🤝‍🧑 **Gemenskap & Coaching:** Skapar nätverk där individer och organisationer kan mötas, dela och växa tillsammans.
*   ❤️ + 🤖 **Hjärta och Teknik:** Förenar hjärtcentrerade metoder med modern teknik (`AI`) för att guida varje resa unikt.
*   🌟 **Inspiration i Handling:** Visar konkreta resultat som inspirerar till mer engagemang och positiv förändring.

Vi gör det inte genom att *tänka* oss fram – vi *känner* oss fram, steg för steg, från hjärtat.

### Frågor Som Leder Oss Framåt ❓

Precis som i *Rising Beyond* låter vi kraftfulla frågor guida oss:

*   🤔 Hur kan vi öppna människors ögon och hjärtan för en större helhet och samhörighet?
*   🤔 Vad händer om vi gör enhet och medkänsla till nya sociala normer som sprider sig viralt?
*   🤔 Hur kan vi skapa verktyg som gör det *enkelt* och *attraktivt* att leva från hjärtat på en global skala?

Dessa frågor är inte bara retorik – de är vår ständiga drivkraft och inspiration.

### Slutord: En Levande Grund 📖

*Visionär Grund* är inte ett statiskt dokument – det är en levande källa som vi återvänder till, reflekterar över, anpassar och växer med. Det hedrar ursprunget i *Rising Beyond*, Ulrikas visionära anda och *Inner Journeys* resa framåt.

Tillsammans med dig – vår gemenskap – kan vi stiga vidare och göra drömmen om en mer enad och hjärtstyrd värld till verklighet.

**Vad betyder den här visionen för dig?** Låt oss bygga den tillsammans.

---

**Med hjärtat som kompass,** ❤️🧭
Joel Kvarnsmyr & Team Inner Journey

## Projektbeskrivning: Inner Journey 📝

En översikt av projektet, dess mål, funktioner och strategier.

*(Baserat på innehåll från `projektbeskrivning_master.md`)*

**✨ Version:** 0.7
**📅 Datum:** 2025-03-24
**👤 Författare:** Bo Joel Kvarnsmyr
**🔄 Senast reviderad av:** Bo Joel Kvarnsmyr

### 💡 Översikt & Unikt Värdeerbjudande

Inner Journey är en plattform för självutveckling som kombinerar praktiska övningar, reflektion och social interaktion. Målet är att hjälpa användare att växa och hantera vardagens utmaningar – **utan fluffiga löften**. Genom en personlig startprocess och ett anpassningsbart gränssnitt blir upplevelsen skräddarsydd och engagerande.

Användare kan utforska övningar, logga reflektioner och koppla upp sig med andra, allt presenterat på ett modernt och användarvänligt sätt.

**För mer information, se:**

*   [Onboarding-process](#) *(Länk ej specificerad)*
*   [Activations: Inner Journey](#) *(Länk ej specificerad)*
*   [Teknisk dokumentation för backend](#) *(Länk ej specificerad)*
*   [Teknisk dokumentation för frontend](#) *(Länk ej specificerad)*

### 🎯 Definierad Målgrupp för Lansering

För att effektivt utveckla och nå ut med Inner Journey prioriteras följande målgrupper:

*   **Primär målgrupp:** Personer som aktivt arbetar med självförbättring – t.ex. coacher, entreprenörer eller individer som redan använder verktyg som meditation eller journaling. De uppskattar verktyg som gör vardagen mer meningsfull och effektiv. 💪
*   **Sekundär målgrupp:** Individer som känner sig fast i rutinerna och söker konkreta sätt att bryta mönster, förbättra sitt mående eller hitta ny riktning – utan att nödvändigtvis vara "spirituella". 🤔

**Gemensamma Psykografiska Egenskaper:**

*   Praktiskt sinnade, nyfikna och öppna för att testa nya verktyg för personlig utveckling.
*   Attraheras av tydliga resultat, smart design och en känsla av kontroll över sin egen resa.
*   Värderar både individuell reflektion och möjligheten att koppla upp sig med andra.

### 🚀 Huvudfunktioner & Koncept

Inner Journey är byggd för att ge användare praktiska verktyg för självutveckling, anpassade efter deras liv och behov. Här är de tre huvudsakliga funktionerna vid lansering:

1.  **Personliga Resor:** Användare kan skapa skräddarsydda planer baserade på sina mål – oavsett om det är att minska stress, hitta fokus eller utforska nya vanor. Plattformen guidar dem steg för steg med övningar och reflektioner. 🗺️
2.  **Dynamisk Journal:** En smart journalfunktion som föreslår frågor och teman baserat på användarens tidigare insikter, vilket gör reflektion både djupare och mer meningsfull. ✍️
3.  **Integrerade Verktyg:** Kombinerar meditation, målsättning och spårning av framsteg i en sömlös upplevelse – allt för att ge användaren kontroll över sin utveckling utan krångel. 🧘🎯📊

**Konceptet i korthet:** Inner Journey är en flexibel följeslagare för självinsikt, designad för att möta användaren där de är och hjälpa dem ta nästa steg – utan pekpinnar eller fluff.

För tekniska detaljer, se [Funktionsspecifikation](#). *(Länk ej specificerad)*

### 💰 Betalningsmodeller

Inner Journey erbjuder en flexibel betalningsstruktur för att passa olika användares behov:

*   **Gratisversion:** Ger tillgång till grundläggande övningar och journalfunktioner. 🎉
*   **Premiumversion:** Låser upp avancerade övningar och personliga planer för en djupare upplevelse. ⭐
*   **Prenumerationsbaserad betalning:** Månads- eller årsprenumerationer för premiumfunktioner, med rabatterade priser för längre åtaganden. 💳

För mer information, se [Betalningsmodeller-dokumentet](#). *(Länk ej specificerad)*

### 🤝 Coaching

Coaching är en naturlig del av resan i Inner Journey. Som användare kan du växa till att bli coach, där du stöttar nya eller befintliga användare utan coach – ett steg som både hjälper andra och fördjupar din egen utveckling.

Coacher arbetar tillsammans med sina användare genom gemensamma uppgifter, och certifierade coacher kan även guida andra coacher.

För mer information, se [Coaching-strategi](#). *(Länk ej specificerad)*

### 📣 Strategi för Användarfeedback & Kommunikation

Inner Journey är byggd för att växa med sina användare. Vi samlar in feedback genom en enkel knapp i appen som länkar till ett kort formulär 📝, och vi håller kontakten via mejl 📧 och en community-kanal 💬.

Detta ger oss möjlighet att snabbt fånga upp användarnas tankar och göra förbättringar löpande. Transparens och användarfokus är nyckeln till en engagerad användarbas.

För mer information, se [Användarfeedback-strategi](#). *(Länk ej specificerad)*

### 💻 Teknisk Implementering (Sammanfattning)

Inner Journey är byggd för att vara smidig och säker. Vi använder:

*   🐍 **Backend:** `Python` (`FastAPI`)
*   ⚛️ **Frontend:** `React` (`TypeScript`)
*   📱 **Tillgänglighet:** Progressive Web App (`PWA`) på alla enheter.
*   🔥 **Infrastruktur:** `Firebase` för autentisering och datalagring (`Firestore`).
*   🤖 **Förstärkning:** `AI` och chattverktyg.

För mer information, se:

*   [Teknisk dokumentation för backend](#) *(Länk ej specificerad)*
*   [Teknisk dokumentation för frontend](#) *(Länk ej specificerad)*

### 🌱 Inledande Strategi för MVP-lansering

MVP:n (Minimum Viable Product) av Inner Journey fokuserar på en stabil grund med:

1.  `Autentisering` 🔒
2.  Enkel `onboarding` 👋
3.  `Daglig loggning` ✍️

Vi lanserar med ett fåtal övningar (t.ex. andning för fokus, reflektionsuppgifter) och ett stilrent gränssnitt inspirerat av Typeform och Superhuman. Användarfeedback kommer att forma nästa steg i utvecklingen.

För mer information, se:

*   [Utvecklingsplan](#) *(Länk ej specificerad)*
*   [Användargränssnitt: Inner Journey](#) *(Länk ej specificerad)*

### 🌟 Framtidsvision & Tillväxtstrategi

Inner Journey siktar på att bli en ledande plattform för praktisk självutveckling, där användare kan ta kontroll över sitt mående och sina mål.

Vi vill växa genom att:

*   Erbjuda flexibla prisalternativ. 💲
*   Bygga en stark community som stöttar både nybörjare och erfarna coacher. 🧑‍🤝‍🧑

För mer information, se:

*   [Utvecklingsplan](#) *(Länk ej specificerad)*
*   [Betalningsmodeller & Integrerad Coaching](#) *(Länk ej specificerad)*

## Teknisk Arkitektur & Miljö 🏗️

Detta avsnitt definierar den övergripande tekniska arkitekturen och utvecklingsmiljön för InnerJourney-plattformen.

*(Baserat på innehåll från `2025-04-02-Arkitektur.md` och `styrdokument_för_innerjourney_1_syfte_och.md`)*

### 🎯 Syfte och Vision (Tekniskt Perspektiv)

*   **Syfte:** Att bygga en robust och skalbar plattform som kombinerar astrologi och AI-interaktion för personlig utveckling. 🌱
*   **Vision:** Att skapa en ledande digital plattform för självreflektion och tillväxt med en intuitiv och säker användarupplevelse globalt. 🌍✨

### 🏗️ Arkitekturöversikt

#### 🐍 Backend

*   **Ramverk:** `FastAPI` (Python) för snabb och effektiv API-utveckling.
*   **Datalagring:** Firebase `Firestore` för flexibel och skalbar NoSQL-databas. 🔥
*   **Hosting:** Google `Cloud Run` för automatisk skalning och containerbaserad deployment. ☁️
*   **Säkerhet:** Google `Cloud Secret Manager` för hantering av API-nycklar och andra hemligheter. 🔑

#### ⚛️ Frontend

*   **Ramverk:** `React` med `TypeScript` för robust och typad kod.
*   **Styling:** `Chakra UI` för ett enhetligt och användarvänligt gränssnitt. 🎨
*   **Autentisering:** `Firebase Authentication` för säker inloggning. 🔒
*   **Hosting:** `Firebase Hosting` för enkel och snabb deployment. 🚀

#### 🌐 Kommunikation

*   API-anrop sker via HTTPS.
*   En `proxy rewrite` i `Firebase Hosting` används för att hantera API-förfrågningar och undvika CORS-problem.

### 🛠️ Utvecklingsmiljö och Verktyg

*   **Versionshantering:** `Git` med `GitHub` som plattform. `main`-branch används för stabil kod, och `feature`-branches skapas för nya funktioner. 🐙
*   **IDE:** Rekommenderade val:
    *   Backend: `VSCode` eller `PyCharm`.
    *   Frontend: `WebStorm` eller `VSCode`. 💻
*   **Kodkvalitet:**
    *   **Frontend:** `ESLint` och `Prettier` för kodformatering och linting. ✨
    *   **Backend:** `Flake8` och `Black` för att säkerställa konsekvent kodstil. ⚫
*   **CI/CD:** `GitHub Actions` för automatiserad testning och deployment vid varje push eller pull request. ⚙️

### 🧩 Modulär Design och Skalbarhet

#### 🐍 Backend

*   **API-design:** `RESTful` endpoints, t.ex. `/init-birthdata` för att spara födelsedata och `/astro-data` för att hämta astrologisk information.
*   **Tjänster:** Logik separeras i moduler, t.ex. `gemini_service.py` för AI-integration och `firebase_service.py` för databasinteraktion.
*   **Framtida integrationer:** Förberedelser för `Dialogflow` (chatbot 🤖) och `ElevenLabs` (röstgenerering 🗣️).

#### ⚛️ Frontend

*   **Navigering:** `React Router` för smidig sidnavigering. 🧭
*   **Komponenter:** Fokus på återanvändbara komponenter som `ActivationForm.tsx` och `AstroResults.tsx`.
*   **State management:** `React Context` eller `Redux` för global tillståndshantering.

### 🔒 Säkerhet

*   **Autentisering:** `Firebase Authentication` med e-post/lösenord. Planerad utökning till telefonverifiering. 📱
*   **API-säkerhet:** Validering av `id_token` i backend för att säkerställa att anrop kommer från autentiserade användare.
*   **Datahantering:** Kryptering av känslig data i `Firestore` (automatiskt) och användning av `Secret Manager` för API-nycklar.
*   **GDPR:** Samtyckesformulär för användare och hantering av personuppgifter enligt gällande lagkrav. 📜

### ✅ Testning och Kvalitetssäkring

*   **Enhetstester:**
    *   **Backend:** `pytest` för att testa API-logik och tjänster.
    *   **Frontend:** `Jest` och `React Testing Library` för komponenttester.
*   **Integrationstester:** Testa API-anrop och autentiseringsflöden end-to-end.
*   **Automatisering:** Tester körs automatiskt i `CI/CD`-pipelinen (`GitHub Actions`) vid varje kodändring. 🤖

### 🚀 Deployment och Underhåll

#### ☁️ Deployment

*   **Backend:** Google `Cloud Run` med automatisk skalning baserat på trafik.
*   **Frontend:** `Firebase Hosting` med `proxy rewrite` för API-anrop.

#### 👀 Övervakning

*   Google `Cloud Logging` för att spåra fel och prestanda.
*   `Firebase Analytics` för att analysera användarbeteende.

#### 🔧 Underhåll

*   Regelbundna uppdateringar av beroenden och säkerhetspatchar.
*   Planerade granskningar av kodbasen för att säkerställa långsiktig hållbarhet.

### 📚 Dokumentation och Onboarding

*   **Teknisk dokumentation:** Centraliserad dokumentation (som detta dokument), en `README.md` per huvudkomponent (backend/frontend) och en `/docs`-mapp (om Docusaurus används) med installationsinstruktioner, arkitekturöversikt och API-dokumentation.
*   **Onboarding-guide:** Steg-för-steg-instruktioner för nya utvecklare, inklusive hur man sätter upp miljön och kör projektet lokalt. 👋

## Backend: Setup, Utveckling & Deployment ⚙️

Detaljerad guide för att arbeta med InnerJourney-backend.

*(Baserat på innehåll från `OnboardingBackend.md`)*

### 1. Lokal Miljö 💻

#### 1.1 Installera Nödvändiga Verktyg 🛠️

För att sätta upp en fungerande lokal miljö behöver du följande verktyg:

*   🐍 **Python 3.10:** Installera denna version för kompatibilitet.
*   📦 **Virtualenv:** Skapa en virtuell miljö för att isolera projektets paket.
    ```bash
    # Skapa virtuell miljö (i projektets rot eller backend-mapp)
    python3.10 -m venv venv

    # Aktivera miljön (Linux/macOS)
    source venv/bin/activate

    # Aktivera miljön (Windows PowerShell)
    # .\venv\Scripts\Activate.ps1
    # Aktivera miljön (Windows CMD)
    # venv\Scripts\activate.bat
    ```
*   🐙 **Git:** För versionshantering.
*   🐳 **Docker:** För att containerisera applikationen (rekommenderas för konsekvent miljö).
*   ☁️ **Google Cloud SDK (`gcloud`):** För att hantera Google Cloud-tjänster lokalt och deploya.

#### 1.2 Klona Projektet från GitHub 📥

Klona repot till din lokala maskin och navigera till projektmappen:

```bash
git clone git@github.com:joelkvarnsmyr/InnerJourney.git
cd InnerJourney
```

#### 1.3 Installera Projektets Beroenden 📜

Installera Python-paketen specificerade i `backend/requirements.txt`:

```bash
# Se till att din virtuella miljö är aktiverad
pip install -r backend/requirements.txt
```

#### 1.4 Konfigurera Lokala Miljövariabler 🔑

Skapa en `.env`-fil i `backend/`-mappen (eller projektets rot, beroende på konfiguration) för att lagra känsliga uppgifter lokalt:

```dotenv
# backend/.env fil exempel
GEMINI_API_KEY="din-lokala-gemini-api-nyckel"
FIREBASE_CREDENTIALS_PATH="~/.secrets/innerjourney-firebase-key.json"
# GOOGLE_CLOUD_PROJECT="ditt-gcp-projekt-id" # Kan behövas för vissa klienter
```

**Viktigt:**
*   Placera din Firebase service account JSON-fil i sökvägen du angav (t.ex. `~/.secrets/innerjourney-firebase-key.json`).
*   Denna fil och `.env`-filen ska **aldrig** checkas in i Git. Se till att de finns i `.gitignore`.

#### 1.5 Starta Servern Lokalt ▶️

Starta FastAPI-servern med `Uvicorn` från projektets rotmapp:

```bash
# Kör från projektets rotmapp (InnerJourney/)
uvicorn backend.main:app --host 0.0.0.0 --port 8080 --reload
```

*   `--reload`: Startar om servern automatiskt vid kodändringar (bra för utveckling).

Servern är nu tillgänglig på `http://localhost:8080`. Du kan nå den automatiska API-dokumentationen (Swagger UI) på `http://localhost:8080/docs`.

Testa en endpoint lokalt, till exempel `/gemini/getActivation`:

```bash
curl -X POST "http://localhost:8080/gemini/getActivation" \
  -H "Content-Type: application/json" \
  -d '{"mood": 2, "goal": "komma igång"}'
```

### 2. Git och Versionshantering 🐙

*   🔗 **Git-repository:** `git@github.com:joelkvarnsmyr/InnerJourney.git`.
*   🌿 **Branch-strategi:**
    *   `main`: Stabil kod, redo för deployment. Endast merge från feature-branches via PR.
    *   `feature/<beskrivande-namn>`: Skapa för nya funktioner eller buggfixar (t.ex. `feature/add-user-profile-endpoint`).
    *   Merge till `main` sker via Pull Requests (PRs) med kodgranskning.
*   💬 **Commit-rutiner:**
    *   Committa ofta med små, logiska ändringar.
    *   Använd tydliga och beskrivande commit-meddelanden (t.ex. enligt Conventional Commits: `feat: Add user profile endpoint`, `fix: Correct Firestore query logic`, `docs: Update backend README`).
*   🚫 **Ignorera känsliga filer:** Säkerställ att `.gitignore` innehåller:
    *   `.env`
    *   `venv/`
    *   `__pycache__/`
    *   `*.pyc`
    *   Sökvägen till dina lokala secrets (t.ex. `~/.secrets/` om du placerar dem där).

### 3. Firebase-integration 🔥

*   💾 **Firestore:** Används som NoSQL-databas. Se [Databasstruktur](#-databasstruktur-innerjourney-firestore) för detaljerad modell. *(Länk internt i detta dokument)*
*   🔑 **Firebase Admin SDK:** Används i backend för server-side interaktion med Firebase.
    *   **Produktion (Cloud Run):** SDK initieras med service account-uppgifter som hämtas säkert från `Google Cloud Secret Manager`.
    *   **Lokalt:** SDK använder sökvägen till service account-filen specificerad i `FIREBASE_CREDENTIALS_PATH` i `.env`.
*   💻 **Kodexempel (Initiering i `firebase_service.py`):**

    ```python
    # Exempel på initiering i backend/services/firebase_service.py
    import firebase_admin
    from firebase_admin import credentials, firestore
    from google.cloud import secretmanager
    import json
    import os
    import logging

    logging.basicConfig(level=logging.INFO)
    logger = logging.getLogger(__name__)

    db = None # Global Firestore client instance

    def get_secret(secret_name, project_id="innerjourney-c007e"):
        """Hämtar den senaste versionen av en hemlighet från Google Secret Manager."""
        # ... (Implementation som i OnboardingBackend.md) ...
        client = secretmanager.SecretManagerServiceClient()
        secret_version_name = f"projects/{project_id}/secrets/{secret_name}/versions/latest"
        try:
            response = client.access_secret_version(name=secret_version_name)
            payload = response.payload.data.decode("UTF-8")
            logger.info(f"Successfully fetched secret: {secret_name}")
            return payload
        except Exception as e:
            logger.error(f"Error fetching secret {secret_name}: {e}")
            return None


    def initialize_firebase():
        """Initializes the Firebase Admin SDK."""
        global db
        if firebase_admin._apps:
            logger.info("Firebase Admin SDK already initialized.")
            if db is None: # Ensure db is set if already initialized but not globally set
                 db = firestore.client()
            return

        # Försök hämta från Secret Manager (Produktion/Cloud Run)
        firebase_credentials_json = get_secret("firebase-credentials") # Name of the secret in Secret Manager
        if firebase_credentials_json:
            try:
                firebase_credentials_dict = json.loads(firebase_credentials_json)
                cred = credentials.Certificate(firebase_credentials_dict)
                firebase_admin.initialize_app(cred)
                db = firestore.client()
                logger.info("✅ Firebase Admin SDK initialized successfully from Secret Manager.")
                return
            except Exception as e:
                logger.error(f"❌ Error initializing Firebase from Secret Manager: {e}")
        else:
             logger.warning("Could not fetch Firebase credentials from Secret Manager. Trying local path.")

        # Fallback till lokal sökväg (Lokal utveckling)
        # Load .env file if running locally without Docker env vars
        from dotenv import load_dotenv
        load_dotenv() # Load from .env in the current directory or parent

        local_path_env = os.getenv("FIREBASE_CREDENTIALS_PATH")
        if local_path_env:
            expanded_path = os.path.expanduser(local_path_env)
            if os.path.exists(expanded_path):
                try:
                    cred = credentials.Certificate(expanded_path)
                    firebase_admin.initialize_app(cred)
                    db = firestore.client()
                    logger.info(f"✅ Firebase Admin SDK initialized successfully from local path: {expanded_path}")
                    return
                except Exception as e:
                    logger.error(f"❌ Error initializing Firebase from local path {expanded_path}: {e}")
            else:
                logger.error(f"❌ Local Firebase credentials file not found at: {expanded_path}")
        else:
            logger.error("❌ FIREBASE_CREDENTIALS_PATH environment variable not set or found.")

        # Om ingen metod lyckades
        if db is None:
             logger.critical("❌❌ Firebase Admin SDK could not be initialized.")


    def save_to_firestore(collection: str, doc_id: str, data: dict):
        """Sparar data till en specifik Firestore-collection."""
        if not db:
            logger.error("Firestore client not initialized. Cannot save data.")
            initialize_firebase() # Attempt to initialize again
            if not db: return False

        try:
            doc_ref = db.collection(collection).document(doc_id)
            doc_ref.set(data, merge=True) # Use merge=True to update existing fields or create new doc
            logger.info(f"💾 Data saved/merged to Firestore: {collection}/{doc_id}")
            return True
        except Exception as e:
            logger.error(f"❌ Error saving to Firestore ({collection}/{doc_id}): {e}")
            return False

    # Initiera Firebase när modulen laddas (eller vid första anrop)
    initialize_firebase()
    ```

### 4. Deployment till Google Cloud Run ☁️

#### 4.1 Förberedelser ✅

*   🏗️ **Google Cloud-projekt:** Projektet `innerjourney-c007e` (eller ditt projekt-ID) måste vara konfigurerat.
*   🔌 **Aktivera API:er:** Säkerställ att följande API:er är aktiverade i GCP-projektet:
    *   `Cloud Run API`
    *   `Secret Manager API`
    *   `Artifact Registry API` (rekommenderas)
    *   `Cloud Build API` (om CI/CD via Cloud Build används)

#### 4.2 Bygg och Pusha Docker-image 🐳

*   📄 **Dockerfile (`backend/Dockerfile`):** Definierar hur applikationen containeriseras.

    ```dockerfile
    # Använd en officiell Python runtime som basimage
    FROM python:3.10-slim

    # Sätt arbetskatalogen i containern
    WORKDIR /app

    # Installera systemberoenden om nödvändigt
    # RUN apt-get update && apt-get install -y --no-install-recommends <package-name> && rm -rf /var/lib/apt/lists/*

    # Kopiera requirements-filen först för att dra nytta av Docker layer caching
    COPY backend/requirements.txt .

    # Uppdatera pip och installera beroenden utan cache
    RUN pip install --no-cache-dir --upgrade pip && \
        pip install --no-cache-dir -r requirements.txt

    # Kopiera resten av applikationskoden (från projektets rot till /app i containern)
    # Se till att .dockerignore exkluderar onödiga filer (venv, .git, .vscode, etc.)
    COPY . .

    # Exponera porten som Uvicorn kommer att lyssna på
    EXPOSE 8080

    # Kör applikationen med Uvicorn när containern startar
    # Cloud Run sätter PORT-variabeln, Uvicorn kan använda den eller en fast port.
    # Använd Gunicorn med Uvicorn workers för produktion.
    CMD ["uvicorn", "backend.main:app", "--host", "0.0.0.0", "--port", "8080"]
    ```
    *(Notera: Justera `COPY` och `WORKDIR` om din struktur är annorlunda)*

*   🏗️➡️☁️ **Bygg och pusha imagen (Manuellt exempel):** Använd Google Cloud Artifact Registry.
    *   Ersätt variabler med dina värden.

    ```bash
    # Definiera variabler
    export PROJECT_ID="innerjourney-c007e"
    export REGION="europe-west1" # Exempel region
    export REPO_NAME="innerjourney-repo" # Ditt repo i Artifact Registry
    export IMAGE_NAME="innerjourney-backend"
    export IMAGE_TAG="latest" # Eller en specifik tagg, t.ex. git commit hash

    # Skapa Artifact Registry repo (om det inte finns)
    # gcloud artifacts repositories create ${REPO_NAME} --repository-format=docker --location=${REGION} --description="Docker repository for InnerJourney"

    # Konfigurera Docker för att autentisera mot Artifact Registry
    gcloud auth configure-docker ${REGION}-docker.pkg.dev

    # Bygg Docker-imagen lokalt (kör från projektets rot, där Dockerfile finns eller specificera sökväg med -f)
    docker build -t ${REGION}-docker.pkg.dev/${PROJECT_ID}/${REPO_NAME}/${IMAGE_NAME}:${IMAGE_TAG} -f backend/Dockerfile .

    # Pusha imagen till Artifact Registry
    docker push ${REGION}-docker.pkg.dev/${PROJECT_ID}/${REPO_NAME}/${IMAGE_NAME}:${IMAGE_TAG}
    ```

#### 4.3 Deploya till Cloud Run 🚀

*   ⌨️ **Deploy-kommando (Manuellt exempel):** Använd `gcloud` för att deploya den pushade imagen.

    ```bash
    # Fortsätt med variabler från föregående steg
    export SERVICE_NAME="innerjourney-backend"
    # Rekommenderat: Skapa ett dedikerat servicekonto för Cloud Run-tjänsten
    export SERVICE_ACCOUNT_EMAIL="[DITT-SERVICEKONTO]@[PROJEKT-ID].iam.gserviceaccount.com" # Exempel

    # Deploy kommando
    gcloud run deploy ${SERVICE_NAME} \
      --image ${REGION}-docker.pkg.dev/${PROJECT_ID}/${REPO_NAME}/${IMAGE_NAME}:${IMAGE_TAG} \
      --platform managed \
      --region ${REGION} \
      --service-account=${SERVICE_ACCOUNT_EMAIL} \
      --allow-unauthenticated \
      --port 8080 \
      --set-secrets=GEMINI_API_KEY=gemini-api-key:latest,FIREBASE_CREDENTIALS=firebase-credentials:latest \
      # --set-env-vars=GOOGLE_CLOUD_PROJECT=${PROJECT_ID} # Kan behövas

      # Ta bort --allow-unauthenticated för produktion och implementera autentisering!
    ```
    *   **Viktigt:** `--allow-unauthenticated` gör tjänsten publik. **Ta bort** detta i produktion och implementera autentisering (t.ex. validering av Firebase `id_token`).
    *   `--set-secrets`: Mappar hemligheter från Secret Manager till containern (antingen som volymer eller miljövariabler). Detta är ett alternativ/komplement till att hämta dem i koden. Anpassa namnen (`gemini-api-key`, `firebase-credentials`) till dina hemligheter i Secret Manager.
    *   Ersätt `[DITT-SERVICEKONTO]` och `[PROJEKT-ID]` med korrekta värden. Servicekontot behöver rätt behörigheter (se nästa punkt).

*   🔗 **Service-URL:** Efter lyckad deployment får du en URL för tjänsten, t.ex. `https://innerjourney-backend-xxxxxxxxxx-ew.a.run.app`.

#### 4.4 Hantera Hemligheter i Cloud Run 🔒

*   🔑 **Secret Manager:** Lagra API-nycklar (`gemini-api-key`) och Firebase service account JSON (`firebase-credentials`) säkert här.
*   🛡️ **Behörigheter:** Cloud Run-tjänstens servicekonto (angivet via `--service-account`) måste ha IAM-rollen `Secret Manager Secret Accessor` (`roles/secretmanager.secretAccessor`) för att kunna hämta hemligheterna (antingen via kod eller via `--set-secrets`). Konfigurera i GCP Console (`IAM & Admin` > `IAM`).

### 5. Felsökning och Vanliga Problem 🐞

#### 5.1 `404 Not Found`

*   🤔 **Orsak:** En specifik route/endpoint (t.ex. `/gemini/getActivation`) hittas inte av FastAPI. Ofta p.g.a. felaktig router-registrering i `backend/main.py` eller stavfel.
*   ✅ **Lösning:**
    1.  Verifiera import: `from backend.routes import gemini` (eller relevant modul) i `main.py`.
    2.  Verifiera inkludering: `app.include_router(gemini.router, prefix="/gemini", tags=["Gemini"])` i `main.py`.
    3.  Kontrollera prefix (`/gemini`) och endpoint-path (`/getActivation`) för stavfel.
    4.  Kontrollera att du anropar rätt fullständig URL.

#### 5.2 `PermissionDenied` vid Åtkomst till Secret Manager

*   🤔 **Orsak:** Cloud Run-tjänstens servicekonto saknar rollen `Secret Manager Secret Accessor`. Syns i Cloud Run-loggarna.
*   ✅ **Lösning:**
    1.  Gå till `IAM & Admin` > `IAM` i GCP Console.
    2.  Hitta servicekontot för din Cloud Run-tjänst.
    3.  Klicka på redigeringspennan (Redigera huvudkonto).
    4.  Klicka `LÄGG TILL YTTERLIGARE EN ROLL`.
    5.  Sök och välj `Secret Manager Secret Accessor`.
    6.  `SPARA`.
    7.  Deploya om tjänsten för att vara säker på att ändringen slår igenom.

#### 5.3 Container failed to start / Application Error

*   🤔 **Orsak:** Applikationen kraschar vid start. Möjliga skäl:
    *   Syntaxfel i Python.
    *   Saknade paket i `requirements.txt` / `Dockerfile`.
    *   Konfigurationsfel (läsa `.env`, initiera Firebase, hämta secrets).
    *   Port-bindningsproblem (`CMD` i `Dockerfile`).
    *   Fel i global kod i `main.py`.
*   ✅ **Lösning:**
    1.  **Kolla loggarna!** Gå till Cloud Run-tjänsten > `LOGGAR` i GCP Console. Leta efter Python tracebacks.
    2.  **Testa lokalt med Docker:** Bygg (`docker build`) och kör (`docker run`) containern lokalt för att felsöka.
        ```bash
        # Bygg lokalt
        docker build -t innerjourney-local -f backend/Dockerfile .
        # Kör lokalt, mappa port, skicka med .env via --env-file eller -e
        docker run -p 8080:8080 --env-file backend/.env innerjourney-local
        ```
    3.  **Verifiera `Dockerfile`, `requirements.txt`, `main.py` och initieringskod.**

## Backend README: Översikt & API 📖

Sammanfattande information och API-dokumentation för backend.

*(Baserat på innehåll från `backend_master.md`)*

### Översikt 📜

Backend för **InnerJourney** är byggd med `FastAPI` (Python 🐍) och integrerar med:

*   Firebase `Firestore` 🔥: Datalagring.
*   Google `Gemini` 🤖: AI-insikter.
*   Google `Cloud Secret Manager` 🔑: Hemlighetshantering.

Den är containeriserad (`Docker` 🐳), deployad på `Cloud Run` ☁️ och byggs/deployas automatiskt via `Cloud Build` 🔧 och `GitHub` 🐙.

### Förutsättningar ✅

*   🐍 Python 3.10
*   🐙 Git
*   🐳 Docker
*   ☁️ Google Cloud SDK (`gcloud`)
*   🔥 Firebase-projekt (Firestore, Auth)
*   🌍 Google Cloud-projekt (Cloud Run, Cloud Build, Secret Manager API:er aktiverade)

### Projektstruktur 🗂️

```text
InnerJourney/
├── backend/
│   ├── models/              # 📋 Pydantic-modeller (t.ex. activation.py)
│   ├── routes/              # 🛤️ API-routes (t.ex. gemini.py)
│   ├── services/            # 🛠️ Affärslogik (t.ex. gemini_service.py, firebase_service.py)
│   ├── __init__.py
│   ├── main.py              # 🏁 FastAPI app entrypoint
│   ├── requirements.txt     # 📜 Beroenden
│   ├── Dockerfile           # 🐳 Container definition
│   └── cloudbuild.yaml      # 🔧 CI/CD konfiguration
├── frontend/
├── .gitignore
└── README.md              # Övergripande README
```

### Sätta upp och testa lokalt med `gcloud`-autentisering 🖥️

För att köra backend lokalt *inuti Docker* och låta den autentisera mot GCP (t.ex. Secret Manager) med dina lokala `gcloud`-credentials:

1.  **Klona repot:**
    ```bash
    git clone git@github.com:joelkvarnsmyr/InnerJourney.git
    cd InnerJourney
    ```
2.  **Autentisera `gcloud` lokalt (om du inte redan gjort det):**
    ```bash
    gcloud auth application-default login
    ```
3.  **Bygg Docker-imagen:**
    ```bash
    docker build -t innerjourney-backend -f backend/Dockerfile .
    ```
4.  **Kör containern och montera `gcloud` config:**
    ```bash
    # Linux/macOS:
    docker run -p 8080:8080 -e PORT=8080 \
      -v ${HOME}/.config/gcloud:/root/.config/gcloud:ro \
      --env-file backend/.env \
      innerjourney-backend

    # Windows (PowerShell): Använd motsvarande sökväg för gcloud config
    # docker run -p 8080:8080 -e PORT=8080 `
    #  -v ${HOME}\AppData\Roaming\gcloud:/root/.config/gcloud:ro `
    #  --env-file backend/.env `
    #  innerjourney-backend
    ```
    *   `-v ... :ro`: Monterar dina lokala Application Default Credentials (ADC) skrivskyddat.
    *   `--env-file backend/.env`: Laddar miljövariabler från din lokala `.env`-fil (för t.ex. `FIREBASE_CREDENTIALS_PATH`).

API:et nås nu på `http://localhost:8080`. Swagger UI: `http://localhost:8080/docs`.

### Deploya till Google Cloud Run med Git och Cloud Build 🌐

Deployment sker automatiskt via `Cloud Build` när ändringar pushas till `main`-grenen på GitHub, baserat på `cloudbuild.yaml`.

1.  **Konfigurera Cloud Build Trigger (Engångs-setup):** Se [Backend Onboarding](#41-frberedelser-) för detaljer om att koppla GitHub och sätta behörigheter.
2.  **Committa och pusha ändringar:**
    ```bash
    git add .
    git commit -m "feat: Lägg till ny endpoint för X"
    git push origin main
    ```
3.  **Följ bygget:** Övervaka i **Cloud Build > History** i GCP Console.
4.  **Testa deployad tjänst:** Använd tjänstens URL från Cloud Run.

### API-dokumentation för frontend-utvecklare 📚

#### Endpoint: `POST /gemini/getActivation`

Genererar en personlig "aktivering" (övning) baserat på humör och mål. Sparar i `Firestore` och returnerar.

*   **URL:** `<Service URL>/gemini/getActivation`
*   **Metod:** `POST`
*   **Request Body:**
    ```json
    {
      "mood": integer, // Obligatorisk (1-5)
      "goal": string   // Obligatorisk (t.ex. "komma igång")
    }
    ```
*   **Response (200 OK):**
    ```json
    {
      "title": string,
      "description": string,
      "duration": integer, // minuter
      "activation_type": string,
      "category_id": string,
      "prompt": string,
      "log_type": string,
      "prerequisite": string,
      "repetitions": integer,
      "questions": list[string],
      "ai_assessment": boolean,
      "coach_approval_required": boolean,
      "net_enabled": boolean,
      "introduction_message": string,
      "preparation_message": string,
      "activation_id": string, // Unikt ID för denna generering
      "source": string // "AI" eller "Predefined"
    }
    ```
*   **Exempel Svar:**
    ```json
    {
      "title": "Fokuserad Andning",
      "description": "En kort andningsövning för att öka fokus och klarhet.",
      "duration": 5,
      // ... (resten av fälten)
      "activation_id": "gemini_1743422072",
      "source": "AI"
    }
    ```
*   **Felhantering:**
    *   `400 Bad Request`: Obligatoriska fält saknas eller ogiltiga värden (t.ex. `mood` utanför 1-5).
    *   `422 Unprocessable Entity`: Fel datatyp i request body (FastAPI validering).
    *   `500 Internal Server Error`: Serverfel (problem med Gemini, Firestore, etc.). Kolla Cloud Run-loggar.

### Säkerhet och Hemligheter 🔒

*   🔑 **Hemligheter:** `GEMINI_API_KEY`, `firebase-credentials` (service account JSON) lagras i Google `Cloud Secret Manager`. **Checka aldrig in i Git.**
*   🛡️ **Åtkomst:**
    *   **Cloud Run:** Servicekontot behöver rollen `Secret Manager Secret Accessor`.
    *   **Lokalt (Docker + gcloud):** Din användare behöver samma roll på GCP-projektet.
*   🔐 **API-skydd:** **Ta bort** `--allow-unauthenticated` i produktion. Implementera validering av Firebase Auth `id_token` i backend för skyddade endpoints.

### Felsökning 🐞

Se [Felsökning i Backend Onboarding](#5-felsökning-och-vanliga-problem-) för:
*   `404 Not Found`
*   `PermissionDenied` (Secret Manager)
*   `Container failed to start`

### Nästa steg 🌟

*   📈 Utöka API:et (profil, loggning, historik).
*   🧪 Implementera tester (`pytest`).
*   🔐 Implementera API-autentisering (validera `id_token`).
*   📊 Förbättra övervakning & loggning.

### Kontakt 📬

Skapa ett issue i GitHub-repositoryt: `joelkvarnsmyr/InnerJourney`.

## Databasstruktur: InnerJourney (Firestore) 🗄️

Beskrivning av den planerade Firestore-databasstrukturen.

*(Baserat på innehåll från `databasstruktur.md`)*

**Version:** 5.0
**Datum:** 2025-03-24
**Författare:** Bo Joel Kvarnsmyr
**Senast reviderad av:** Bo Joel Kvarnsmyr

### 🎯 Syfte & Översikt

Designad för att lagra och hantera användardata säkert, skalbart och effektivt med Firebase `Firestore`. Stödjer kärnfunktioner:

*   Personlig profilering (astrologi, numerologi, svar). 👤✨🔢
*   Loggning av övningar (`activations`), inkl. live-interaktioner och AI-analyser. 💪📝🤖
*   Framtida sociala interaktioner och coachverktyg. 🧑‍🤝‍🧑🤝

> **📝 OBS (Status Mars 2025):** `Firestore` är **inte** fullt implementerat i backend ännu. Viss data kan lagras temporärt (t.ex. `call_status` i minnet). Strukturen nedan är den **planerade och målsatta** modellen.

För en bredare översikt, se [Projektbeskrivning](#projektbeskrivning-inner-journey-). *(Länk internt i detta dokument)*

### 🗂️ Samlingar & Fält (Planerad Firestore Struktur)

---

#### 👤 Samling: `users`

**Beskrivning:** Huvudsamling för användarprofiler.
**Dokument-ID:** Användarens UID från `Firebase Authentication` (t.ex. `abc123xyz`).

**Fält:**

*   `userId`: `String` - (Redundant om ID=UID, men kan behållas). Samma som dokument-ID.
*   `birthDate`: `String` - `YYYY-MM-DD` (t.ex. `"1990-05-15"`).
*   `birthTime`: `String` - `HH:MM` (t.ex. `"14:30"`).
*   `birthLocation`: `String` - (t.ex. `"Stockholm, Sweden"`).
*   `phoneNumber`: `String` (Valfritt) - Verifierat nummer (t.ex. `"+447418631211"`).
*   `email`: `String` - Användarens e-post (från `Firebase Auth`).
*   `displayName`: `String` (Valfritt) - Visningsnamn.
*   `createdAt`: `Timestamp` - När kontot skapades i `Firestore`.
*   `lastLoginAt`: `Timestamp` - Senaste inloggning (uppdateras via backend/funktion).
*   `onboardingCompleted`: `Boolean` - Om onboarding är klar.
*   `preferences`: `Object` - Inställningar:
    *   `uiStyle`: `String` - UI-tema (t.ex. `"clean"`, `"technical"`).
    *   `focusArea`: `String` - Mål (t.ex. `"stress_relief"`, `"focus"`).
    *   `timeCommitment`: `Number` - Tid per dag (minuter).
    *   `notificationsEnabled`: `Boolean`.
*   `profile`: `Object` - Genererad profil:
    *   `personalityTraits`: `Array<String>` - Egenskaper från svar (t.ex. `["introvert"]`).
    *   `astroSign`: `String` - Soltecken (t.ex. `"Taurus"`).
    *   `lifePathNumber`: `Number` - Livsvägstal (t.ex. `7`).
    *   `neuroTendencies`: `Object` - Indikatorer:
        *   `adhdScore`: `Number` (0-10).
        *   `autismScore`: `Number` (0-10).
    *   `wellbeingFlags`: `Object` - Välmåendemarkörer:
        *   `depressionRisk`: `Boolean`.
        *   `suicideRisk`: `Boolean`. *(Hanteras varsamt!)*
*   `onboardingAnswers`: `Array<Object>` - Råsvar från onboarding (t.ex. `[{"questionId": "q1", "answer": "Draining"}]`).

**💡 Flexibilitet:** Utöka med `moonSign`, `risingSign`, `progressLevel`, `assignedCoachId` etc.

---

#### 💪 Samling: `activations` (Tidigare `exercises`)

**Beskrivning:** Definitioner av alla tillgängliga aktiveringar.
**Dokument-ID:** Unikt ID (t.ex. `"hemisync_focus_001"`).

**Fält:**

*   `activationId`: `String` - (Redundant om ID används). Samma som dokument-ID.
*   `title`: `String` - (t.ex. `"Hemisync Fokus"`).
*   `type`: `String` - Typ (t.ex. `"audio_guided"`, `"live_interaction_video"`, `"ai_assessment_movement"`).
*   `description`: `String` - Kort introduktion.
*   `durationMinutes`: `Number` - Varaktighet (minuter).
*   `mediaUrl`: `String` (valfritt) - Länk till media i `Firebase Storage`.
*   `category`: `String` - (t.ex. `"awareness"`, `"social"`).
*   `tags`: `Array<String>` - Etiketter (t.ex. `["focus", "hemisync"]`).
*   `instructions`: `String` - Steg-för-steg (kan vara Markdown).
*   `logPrompts`: `Array<String>` - Frågor för reflektion.
*   `requiredEquipment`: `Array<String>` - (t.ex. `["headphones"]`).
*   `isPremium`: `Boolean` - Kräver premium?

**💡 Flexibilitet:** Utöka med `difficultyLevel`, `prerequisites`.

---

#### 📝 Samling: `user_activation_logs` (Tidigare `user_exercises`)

**Beskrivning:** Loggar en användares genomförande av en aktivering.
**Dokument-ID:** Unikt auto-genererat ID.

**Fält:**

*   `logId`: `String` - (Redundant). Samma som dokument-ID.
*   `userId`: `String` - Ref till `users` UID.
*   `activationId`: `String` - Ref till `activations`.
*   `startedAt`: `Timestamp`.
*   `completedAt`: `Timestamp`.
*   `status`: `String` - (t.ex. `"started"`, `"completed"`).
*   `logData`: `Object` - Användarens logg:
    *   `textReflection`: `String` (valfritt).
    *   `rating`: `Number` (valfritt) - Betyg (1-5).
    *   `moodBefore`: `Number` (valfritt) - Humör (1-5).
    *   `moodAfter`: `Number` (valfritt) - Humör (1-5).
    *   `audioLogUrl`: `String` (valfritt) - Länk till ljudlogg (planerat).
    *   `videoLogUrl`: `String` (valfritt) - Länk till videologg (planerat).
    *   `aiAnalysisResult`: `Object` (valfritt) - Resultat från AI (t.ex. `{ "balanceScore": 8.5 }`).
*   `liveSessionId`: `String` (valfritt) - Ref till `live_sessions`.

**💡 Flexibilitet:** Utöka med `coachFeedback`. Skapa index på `userId` och `completedAt`.

---

#### 👥 Samling: `live_sessions`

**Beskrivning:** Data för live-interaktioner.
**Dokument-ID:** Unikt ID (t.ex. `"live_session_xyz789"`).

**Fält:**

*   `sessionId`: `String` - (Redundant). Samma som dokument-ID.
*   `activationId`: `String` - Ref till `activations`.
*   `participants`: `Array<String>` - Lista med `userId`.
*   `status`: `String` - (t.ex. `"waiting_for_participants"`, `"in_progress"`, `"completed"`).
*   `startTime`: `Timestamp`.
*   `endTime`: `Timestamp` (valfritt).
*   `sessionData`: `Object` (valfritt) - Teknisk data (WebRTC info, inspelning?).
*   `reflections`: `Map<String, Object>` (valfritt) - Reflektioner per `userId`.
    *   `"user_abc": { "text": "...", "submittedAt": Timestamp }`

**💡 Flexibilitet:** Utöka med `maxParticipants`, `inviteCode`.

---

#### ✅ Samling: `consents`

**Beskrivning:** Lagrar användares samtycken (GDPR etc.).
**Dokument-ID:** Användarens UID (`userId`).

**Fält:**

*   `userId`: `String` - (Redundant). Samma som dokument-ID.
*   `consentHistory`: `Array<Object>` - Lista med samtycken:
    *   `type`: `String` - (t.ex. `"terms_and_conditions"`, `"privacy_policy"`).
    *   `version`: `String` - (t.ex. `"v1.0"`).
    *   `agreedAt`: `Timestamp`.
    *   `status`: `String` - `"granted"` eller `"revoked"`.

---

#### 📞 Samling: `call_sessions` (Tidigare `sessions`)

**Beskrivning:** Temporär status för specifika flöden (t.ex. telefonverifiering). Använd Firestore TTL.
**Dokument-ID:** Unikt ID (t.ex. `"call_verify_abc123"`).

**Fält:**

*   `sessionId`: `String` - (Redundant). Samma som dokument-ID.
*   `type`: `String` - (t.ex. `"phone_verification"`).
*   `userId`: `String` - Ref till `users`.
*   `status`: `String` - (t.ex. `"initiated"`, `"code_sent"`, `"verified"`).
*   `data`: `Object` - Sessionsspecifik data:
    *   `verificationCodeHash`: `String` - Hashad kod.
    *   `phoneNumber`: `String`.
    *   `attempts`: `Number`.
*   `createdAt`: `Timestamp`.
*   `expiresAt`: `Timestamp` - För TTL Policy.

### 📊 Exempeldata (Illustrativt)

Se [Databasstruktur (Firestore) - Exempeldata](#-exempeldata-illustrativt-) för JSON-exempel. *(Länk internt i detta dokument)*

### ✏️ Datainmatning & Användning

*   **Onboarding:** Frontend samlar data -> Skickar till backend -> Backend processar (astro/numero) & sparar i `users` och `consents`.
*   **Aktiveringar:** Frontend hämtar från `activations` -> Vid start/slut skapar/uppdaterar backend logg i `user_activation_logs`. Live-interaktioner använder `live_sessions`.
*   **Samtal/Sessioner:** Backend använder `call_sessions` för temporära flöden.

### 💻 Teknisk Implementering

*   **Firebase Setup:** Kräver konfig av `Firestore`, `Storage`, `Authentication`, `Cloud Functions` (ev.), `Firestore Rules`.
*   **Backend (`FastAPI`):** Affärslogik, validering (Pydantic), beräkningar (t.ex. `Flatlib`), interaktion med AI, CRUD mot `Firestore` (Admin SDK).
*   **Säkerhetsregler (`Firestore Rules`):** **KRITISKT!** Definiera regler för att begränsa åtkomst (användare kan bara komma åt sin egen data). Se exempel i [Databasstruktur (Firestore) - Teknisk Implementering](#-teknisk-implementering-1). *(Länk internt i detta dokument)*
*   **Indexering:** Skapa Firestore-index för vanliga queries (t.ex. `user_activation_logs` på `userId` och `completedAt`).

### 🛡️ Säkerhet & GDPR

*   **Kryptering:** Automatiskt av Firestore/GCP (`at rest`, `in transit`).
*   **Åtkomstkontroll:** `Firestore Rules` (klient) + `id_token`-validering (backend API).
*   **Anonymisering/Pseudonymisering:** Använd `userId` (Firebase UID).
*   **Radering:** Implementera säker raderingsfunktion (via backend/Cloud Function) för kontoborttagning (rensar `users`, `user_activation_logs`, `consents`, etc.).
*   **Lagringstid:** Använd TTL för `call_sessions`. Definiera policy för loggdata/media i `Storage`.
*   Se dedikerat [Säkerhetsdokument](#) *(Länk ej specificerad)*.

### 🔗 Koppling till Övriga Dokument

Strukturen stödjer krav från:
*   [Projektbeskrivning](#projektbeskrivning-inner-journey-)
*   [Användargränssnitt](#) *(Länk ej specificerad)*
*   [Utvecklingsplan](#) *(Länk ej specificerad)*
*   [Onboarding-process](#) *(Länk ej specificerad)*

## Projekthantering med GitHub Projects 🗺️

Guide för hur teamet använder GitHub Projects för "Inner Journey MoSCoW".

*(Baserat på innehåll från `Upptäck AI-Projekt på GitHub`)*

### Syfte 🎯

Att standardisera användningen av fält i GitHub Projects för att effektivt hantera uppgifter, prioriteringar (MoSCoW) och arbetsflöden. Främjar transparens, samarbete och kontinuerlig förbättring. ✨

### Instruktioner för Användning av GitHub Project Fält 📝

#### 1. `Title` (Kortets Titel)

*   **Vad:** Kort, tydlig titel för uppgiften.
*   **Hur:** Specifik, koncis, gärna med verb (t.ex. "Implementera X").
*   **Exempel:** `Implementera formulär för födelsedata`.

#### 2. `Body` (Beskrivning & Checklistor)

*   **Vad:** Detaljerad beskrivning, mål, kontext, checklista för deluppgifter.
*   **Hur:**
    *   Beskriv **vad** och **varför**.
    *   Använd Markdown.
    *   Checklista under `**Tasks:**` (`- [ ]` / `- [x]`).
*   **Exempel:**
    ```markdown
    **Mål:** Samla in användarens födelsedata för astrologisk profil (MVP).

    **Tasks:**
    - [ ] Skapa React-komponent (`BirthDataForm.tsx`).
    - [ ] Implementera validering.
    - [ ] Lägg till API-anrop (`/users/birthdata`).
    - [ ] Hantera API-svar.
    - [ ] Skriv enhetstest.
    ```

#### 3. `Assignees` 🧑‍💻 (Tilldelade)

*   **Vad:** Ansvariga teammedlemmar.
*   **Hur:** Tilldela via GitHub-användarnamn. Kommunicera.
*   **Exempel:** `@joelkvarnsmyr`.

#### 4. `Labels` 🏷️ (Etiketter)

*   **Vad:** Kategorisering (MoSCoW, område, typ).
*   **Hur:** Välj från listan. Viktiga:
    *   MoSCoW: `Must have`, `Should have`, `Could have`, `Won't have`
    *   Område: `Backend`, `Frontend`, `Onboarding`, `Design`, `Docs`
    *   Typ: `Bug`, `Feature`, `Task`, `Research`
*   **Exempel:** `Must have`, `Frontend`, `Feature`.

#### 5. `Milestone` 📍 (Milstolpe)

*   **Vad:** Kopplar till övergripande leverans/fas (sprint, release).
*   **Hur:** Välj från listan (t.ex. `Sprint 1`, `MVP Release`).
*   **Exempel:** `Sprint 1`.

#### 6. `State` 🚦 (Issue Status)

*   **Vad:** `open` eller `closed` (för kopplade Issues).
*   **Hur:** `open` vid skapande, `closed` när helt klar och godkänd.
*   **Exempel:** `open`.

#### 7. `Status` 📊 (Kolumn på Tavlan)

*   **Vad:** Visar kortets plats i arbetsflödet.
*   **Hur:** Flytta kortet mellan kolumner:
    *   `IDEAS`: Framtida idéer.
    *   `Backlog`: Identifierade men ej redo.
    *   `Ready`: Specade, prioriterade, redo för nästa iteration.
    *   `In progress`: Aktivt arbete pågår.
    *   `In review`: Klart för granskning (kod, QA, design).
    *   `Done`: Slutfört, granskat, godkänt (issue stängs ofta här).
*   **Exempel:** `In progress`.

#### 8. `Sub-issues progress` 📈 (Automatiskt)

*   **Vad:** Framsteg för checklistan i `Body`.
*   **Hur:** Uppdateras **automatiskt** när `- [ ]` blir `- [x]`.
*   **Exempel:** `2/5 (40%)`.

#### 9. `Priority` 🔥 (Finprioritering)

*   **Vad:** Prioritet *inom* en status/MoSCoW-kategori.
*   **Hur:** Skala (anpassa): `P0` (Urgent), `P1` (High), `P2` (Medium), `P3` (Low).
*   **Exempel:** `P1`.

#### 10. `Size` 📏 (Storlek/Komplexitet)

*   **Vad:** Grov uppskattning (T-shirt sizing).
*   **Hur:** `Small` (S), `Medium` (M), `Large` (L), `X-Large` (XL). Baseras på teamets definition.
*   **Exempel:** `Medium`.

#### 11. `Estimate` ⏱️ (Uppskattning)

*   **Vad:** Specifik uppskattning (timmar, story points).
*   **Hur:** Ange numeriskt värde enligt teamets enhet.
*   **Exempel:** `8` (t.ex. story points).

#### 12. `Iteration` 🔄 (Sprint)

*   **Vad:** Kopplar till specifik tidsbestämd iteration.
*   **Hur:** Välj från listan (t.ex. `Iteration 1: Apr 02 – Apr 15`).
*   **Exempel:** `Iteration 1: Apr 02 – Apr 15`.

#### 13. `Start date` 📅 (Planerad Start)

*   **Vad:** Planerat startdatum.
*   **Hur:** Ange `YYYY-MM-DD`.
*   **Exempel:** `2025-04-02`.

#### 14. `End date` 📅 (Planerat Slut)

*   **Vad:** Planerat slutdatum.
*   **Hur:** Ange `YYYY-MM-DD`.
*   **Exempel:** `2025-04-05`.

#### 15. `MoSCoW` ⚖️ (Prioritet)

*   **Vad:** Prioriteringsnivå (kan vara Label eller dedikerat fält).
*   **Hur:** Välj:
    *   `Must have`: Kritiskt för MVP/release.
    *   `Should have`: Viktigt, men inte kritiskt för *denna* release.
    *   `Could have`: Önskvärt ("nice to have").
    *   `Won’t have` (this time): Inte planerat nu.
*   **Exempel:** `Must have`.

#### 16. `User Value` ⭐ (Användarnytta)

*   **Vad:** Uppskattning av värde för slutanvändaren.
*   **Hur:** Skala (t.ex. 1-5): 1=låg, 5=hög.
*   **Exempel:** `5`.

#### 17. `Dependencies` 🔗 (Beroenden)

*   **Vad:** Beroenden till/från andra kort/issues.
*   **Hur:** Använd GitHubs länkning ("blocked by", "blocking") eller text: `"Blocked by #123"`, `"Blocks #456"`.
*   **Exempel:** `Blocked by #12`.

#### 18. `Objective` 🏁 (Mål/Resultat)

*   **Vad:** Kort beskrivning av vad som uppnås när kortet är klart.
*   **Hur:** 1-2 meningar om "Definition of Done".
*   **Exempel:** `Användare kan ange och spara födelsedata.`

#### 19. `Team` 👥 (Ansvarigt Team)

*   **Vad:** Primärt ansvarigt team (om flera).
*   **Hur:** Välj från lista: `Dev`, `Design`, `Backend`, `Frontend`, etc.
*   **Exempel:** `Frontend`.

#### 20. `Release version` 🚀 (Release)

*   **Vad:** Planerad release-version.
*   **Hur:** Välj: `R1` (MVP), `R2` (Nästa), `R3` (Framtid).
*   **Exempel:** `R1`.

### Riktlinjer för Kontinuerlig Utvärdering 🤔✨

*   **Regelbunden genomgång:** Uppdatera tavlan vid sprintplanering/retro.
*   **Hantera beroenden:** Lös blockeringar aktivt.
*   **Prioritera för release:** Använd `Release version` och `MoSCoW` för att fokusera.
*   **Anpassa processen:** Utvärdera och justera fält/flöde i retrospektiv.

### Exempel på ett Kort ✅

*   **Issue/Kort:** #15: Implementera formulär för födelsedata
*   **Title:** Implementera formulär för födelsedata
*   **Body:** *(Se exempel ovan)*
*   **Assignees:** `@joelkvarnsmyr`
*   **Labels:** `Must have`, `Frontend`, `Onboarding`, `Feature`
*   **Milestone:** `Sprint 1`
*   **State:** `open`
*   **Status:** `In progress`
*   **Sub-issues progress:** `0/5 (0%)`
*   **Priority:** `P1`
*   **Size:** `Medium`
*   **Estimate:** `13` (sp)
*   **Iteration:** `Iteration 1: Apr 02 – Apr 15`
*   **Start date:** `2025-04-02`
*   **End date:** `2025-04-05`
*   **MoSCoW:** `Must have`
*   **User Value:** `5`
*   **Dependencies:** `Blocked by #12`
*   **Objective:** `Användare kan ange och spara födelsedata.`
*   **Team:** `Frontend`
*   **Release version:** `R1`

### Avslutande Kommentar 👋

Använd detta som en levande guide. Var konsekventa, men anpassa efter behov för att skapa en tydlig och effektiv arbetsmiljö. Lycka till! 🚀