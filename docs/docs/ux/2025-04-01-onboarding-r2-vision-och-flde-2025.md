---
description: Detaljerad beskrivning av vision, syfte och tekniskt fl√∂de f√∂r onboarding
  R2 i InnerJourney
id: onboarding-r2-vision-och-flde-2025
sidebar_label: 'Onboarding R2: Vision och Fl√∂de'
sidebar_position: 10
slug: onboarding-r2-vision-och-flde-2025
tags:
- onboarding
- user-flow
- vision
- technical-specification
- ui
title: '"Onboarding R2: Vision och Fl√∂de"'
---

# ‚ú® Onboarding R2: Vision och Fl√∂de

## üìÑ Dokumentinformation

*   **Version:** 1.0 (Vision), 2.0 (Teknisk Process)
*   **Datum:** `2025-03-25`
*   **F√∂rfattare:** Bo Joel Kvarnsmyr
*   **Senast reviderad av:** Bo Joel Kvarnsmyr

## üåü Vision och Syfte

### Vision üî≠

Onboarding-processen f√∂r InnerJourney √§r designad f√∂r att vara en **transformerande och engagerande introduktion** som s√§tter tonen f√∂r anv√§ndarens resa mot sj√§lvuppt√§ckt och personlig utveckling.

V√•r vision √§r att skapa en upplevelse som k√§nns **intuitiv, trygg och personlig**, d√§r varje anv√§ndare k√§nner sig sedd och f√∂rst√•dd fr√•n f√∂rsta stund. Genom att kombinera avancerad teknologi (som `AI` och `astrologiska insikter`) med en empatisk och naturlig interaktion, vill vi bygga en bro mellan anv√§ndarens inre v√§rld och de verktyg och uppdrag som kan hj√§lpa dem att v√§xa. üå±

### Syfte üéØ

Syftet med onboardingen √§r att:

1.  ü§ù **Skapa en personlig koppling:** Genom att samla in grundl√§ggande data (`f√∂delsedetaljer`) och anv√§nda talbaserade fr√•gor f√∂r att f√∂rst√• anv√§ndarens personlighet, preferenser och v√§lm√•endemark√∂rer, kan vi skapa en profil som g√∂r att anv√§ndaren k√§nner sig sedd och f√∂rst√•dd.
2.  üé® **Personifiera upplevelsen:** Anv√§nda profilen f√∂r att anpassa uppdrag, coaching och rekommendationer, s√• att varje anv√§ndare f√•r en resa som √§r skr√§ddarsydd f√∂r deras unika behov, erfarenhetsniv√• och spirituella utveckling.
3.  üõ°Ô∏è **Bygga f√∂rtroende:** Genom en trygg och empatisk interaktion med en AI-agent, som st√§ller fr√•gor p√• ett naturligt och icke-d√∂mande s√§tt, vill vi etablera f√∂rtroende och uppmuntra anv√§ndaren att forts√§tta sin resa med InnerJourney.
4.  ü©∫ **Identifiera behov:** Uppt√§cka tendenser f√∂r depression, sj√§lvmord, ADHD, autism eller liknande, samt bed√∂ma anv√§ndarens erfarenhet av spirituella praktiker (t.ex. meditation, breathwork) och niv√• av uppvaknande, f√∂r att ge r√§tt st√∂d och resurser.

### K√§rnv√§rden ‚ù§Ô∏è

*   üíñ **Empati:** Onboardingen ska k√§nnas varm, inbjudande och icke-d√∂mande.
*   üë§ **Personalisering:** Varje anv√§ndares resa ska vara unik och anpassad.
*   ‚úÖ **Enkelhet:** Processen ska vara intuitiv och fri fr√•n on√∂diga hinder.
*   üîç **Transparens:** Anv√§ndaren ska aldrig k√§nna att n√•got √§r dolt eller manipulerande.

## üó∫Ô∏è √ñversikt √∂ver Faser

Onboarding-processen best√•r av f√∂ljande huvudsakliga faser:

1.  üéÇ **Insamling av grunddata:** Anv√§ndaren anger f√∂delsedatum, tid och plats via enkla formul√§r.
2.  üìû **Telefonverifiering:** Anv√§ndaren verifierar sitt konto via ett telefonsamtal d√§r en AI-agent l√§ser upp en kod.
3.  üó£Ô∏è **Talbaserad profilering:** I samma samtal st√§ller AI-agenten personliga fr√•gor och f√∂ljdfr√•gor f√∂r att skapa en verifierad personlighetsprofil, inklusive erfarenhet av spirituella praktiker och niv√• av uppvaknande.
4.  üéØ **Tilldelning av f√∂rsta uppdrag:** Baserat p√• profilen tilldelas anv√§ndaren ett f√∂rsta uppdrag, anpassat till deras niv√• och behov.

> ‚ÑπÔ∏è F√∂r en mellanliggande √∂versikt av processen, se dokumentet `Onboarding-process`. F√∂r en detaljerad beskrivning av stegen, se avsnittet nedan.

## üöÄ Detaljerat Onboarding-fl√∂de

Detta avsnitt ger en detaljerad beskrivning av varje steg i onboardingen f√∂r InnerJourney, inklusive anv√§ndarupplevelse och tekniska detaljer.

### Steg 1: Ange F√∂delsedatum üìÖ

**üë§ Anv√§ndarupplevelse:**

*   Anv√§ndaren landar p√• startsidan (`/`) p√• `innerjourney.kvarnsmyr.se`.
*   Ett formul√§r visas direkt f√∂r att fylla i f√∂delsedatum (format: `DD/MM/YYYY`).
*   Efter ifyllnad klickar anv√§ndaren p√• knappen "Begin" f√∂r att g√• vidare.
*   *Sidnot (inloggning):* Klick p√• logotypen visar en inloggningsvy (`/login`) f√∂r befintliga anv√§ndare.

**üí° Tekniskt:**

*   **Frontend:**
    *   Routen `/` renderar komponenten `BirthDatePage.tsx` (byggd med `React`, `TypeScript`, `Chakra UI`).
    *   Formul√§ret anv√§nder `react-input-mask` f√∂r datumformatering.
    *   Knappen "Begin" aktiveras n√§r ett giltigt datum har angetts (lokal validering).
    *   Inga API-anrop g√∂rs i detta steg.
    *   Vid klick p√• "Begin" navigeras anv√§ndaren till routen `/birth-time` (Steg 2).
    *   *Sidnot (inloggning):* Klick p√• logotypen navigerar till `/login` (komponenten `LoginPage.tsx`) som anv√§nder `Firebase Authentication`.
*   **Backend:** Inga anrop.
*   **Firebase:** `Firebase Authentication` √§r konfigurerad i `firebase.ts`, men anv√§nds endast f√∂r inloggning via logotyp-klicket i detta skede.

### Steg 2: Ange F√∂delsetid ‚è∞

**üë§ Anv√§ndarupplevelse:**

*   Anv√§ndaren navigeras till sidan `/birth-time`.
*   Ett formul√§r visas med tv√• dropdown-menyer: en f√∂r timme (00‚Äì23) och en f√∂r minut (00‚Äì59).
*   Anv√§ndaren v√§ljer tid och klickar p√• knappen "Next".

**üí° Tekniskt:**

*   **Frontend:**
    *   Routen `/birth-time` renderar komponenten `BirthTimePage.tsx` (`React`, `TypeScript`, `Chakra UI`).
    *   Dropdown-menyerna implementeras med `<Select>`-komponenten fr√•n `Chakra UI`.
    *   F√∂delsedatum fr√•n Steg 1 sparas tempor√§rt i `SessionContext.tsx`.
    *   Knappen "Next" √§r alltid aktiv efter att ett val har gjorts.
    *   Vid klick p√• "Next" navigeras anv√§ndaren till routen `/birth-location` (Steg 3).
    *   Inga API-anrop g√∂rs i detta steg.
*   **Backend:** Inga anrop.
*   **Firebase:** Ingen autentisering kr√§vs i detta steg.

### Steg 3: Ange F√∂delseplats üìç

**üë§ Anv√§ndarupplevelse:**

*   Anv√§ndaren navigeras till sidan `/birth-location`.
*   Ett formul√§r visas med ett textf√§lt f√∂r att ange f√∂delseplats (t.ex. "Stockholm, Sweden").
*   En autocomplete-funktion f√∂resl√•r giltiga st√§der medan anv√§ndaren skriver.
*   Anv√§ndaren v√§ljer en plats fr√•n f√∂rslagen och klickar p√• "Confirm".

**üí° Tekniskt:**

*   **Frontend:**
    *   Routen `/birth-location` renderar komponenten `BirthLocationPage.tsx` (`React`, `TypeScript`, `Chakra UI`).
    *   Textf√§ltet (`<Input>`) integreras med `react-places-autocomplete` (eller motsvarande `Google Places API`-integration).
    *   Vid val av plats sparas platsnamn och koordinater tempor√§rt i `SessionContext.tsx`, tillsammans med data fr√•n tidigare steg (datum och tid).
    *   Knappen "Confirm" aktiveras n√§r en giltig plats har valts.
    *   Vid klick p√• "Confirm" navigeras anv√§ndaren till routen `/verify` (Steg 4).
    *   Inga API-anrop g√∂rs i detta steg.
*   **Backend:** Inga anrop.
*   **Firebase:** Ingen autentisering kr√§vs i detta steg.

### Steg 4: Telefonverifiering üìû

**üë§ Anv√§ndarupplevelse:**

*   Anv√§ndaren navigeras till sidan `/verify`.
*   Ett klickbart telefonnummer (t.ex. `+46701234567`) visas, formaterat som en `href="tel:..."`-l√§nk.
*   Ett textf√§lt visas d√§r anv√§ndaren ska ange en verifieringskod.
*   Anv√§ndaren ringer det angivna numret. En AI-agent svarar: "Ditt samtal √§r v√§ntat." och fr√•gar sedan "Du kommer f√• en kod av mig att skriva in i din webbl√§sare, √§r du redo att g√∂ra det?".
*   Vid bekr√§ftelse (t.ex. genom att s√§ga "Ja") l√§ser agenten upp koden (t.ex. "123456").
*   Anv√§ndaren anger den uppl√§sta koden i textf√§ltet p√• webbsidan och klickar p√• "Verify".

**üí° Tekniskt:**

*   **Frontend:**
    *   Routen `/verify` renderar komponenten `VerificationPage.tsx` (`React`, `TypeScript`, `Chakra UI`).
    *   Vid sidladdning g√∂rs 3 API-anrop till backend:
        1.  **`/init-birthdata`**:
            ```text
            - Request Body: { birth_date, birth_time, birth_location }
            - Response Body: { session_id: "abc123" }
            - Syfte: Spara f√∂delsedata i Firestore (samlingen `sessions`).
            ```
        2.  **`/astro-data`**:
            ```text
            - Request Body: { birth_date, birth_time, birth_location }
            - Response Body: { /* Astrologiska data (planeter, hus etc.) */ }
            - Syfte: H√§mta och spara astrodata i Firestore (t.ex. `users/abc123/astroData`).
            ```
        3.  **`/get-verification-number`**:
            ```text
            - Request Body: { session_id: "abc123", country: "SE" }
            - Response Body: { phone_number: "+46701234567" }
            - Syfte: H√§mta verifieringsnummer och initiera kodgenerering p√• backend.
            ```
    *   Telefonnumret fr√•n `/get-verification-number` visas som en klickbar `<a>`-l√§nk. Ett `<Input>`-f√§lt visas f√∂r koden.
    *   Returnerat `session_id` sparas i `SessionContext.tsx`.
    *   Vid klick p√• "Verify" g√∂rs ett API-anrop till `/phone/verify`:
        ```text
        - Request Body: { session_id: "abc123", verification_code: "123456" }
        - Response Body: { status: "SUCCESS" }
        - Syfte: Verifiera koden och koppla telefonnummer till anv√§ndaren.
        ```
    *   Om verifieringen lyckas (`status === "SUCCESS"`), navigeras anv√§ndaren till `/profile-questions` (Steg 5).

*   **Backend:**
    *   Endpoint `/init-birthdata`: Sparar mottagen data i `Firestore` under `sessions/{session_id}`.
    *   Endpoint `/astro-data`: Anropar externt `VedAstro API`, bearbetar svaret och sparar resultatet i `Firestore` under `users/{session_id}/astroData`.
    *   Endpoint `/get-verification-number`: Returnerar ett telefonnummer (t.ex. via `Sinch`), genererar en verifieringskod och sparar den (hashad) i `Firestore` under `sessions/{session_id}/verificationCode`. Initierar f√∂rv√§ntan p√• inkommande samtal.
    *   Samtalshantering: Inkommande samtal tilldelas via `Sinch Voice API` till ett `Dialogflow CX`-fl√∂de.
    *   Endpoint `/phone/verify`: Verifierar den inskickade koden mot den lagrade koden f√∂r `session_id`. Om korrekt, kopplas det inringande numret (fr√•n samtalsinformationen) till anv√§ndaren i `Firestore` (t.ex. `users/{session_id}/phoneNumber`).

*   **Firebase:**
    *   `sessions`-samlingen: Lagrar tempor√§r sessionsdata (f√∂delsedata, verifieringskod). Kan rensas efter en viss tid.
    *   `users`-samlingen: Lagrar permanent anv√§ndardata (astrodata, telefonnummer efter verifiering). `session_id` blir anv√§ndarens initiala ID.

### Steg 5: Talbaserad Profilering üó£Ô∏è

**üë§ Anv√§ndarupplevelse:**

*   Anv√§ndaren navigeras till sidan `/profile-questions`.
*   Text p√• sk√§rmen uppdateras f√∂r att visa status: "Verification under progress..." -> "Call under progress...".
*   Telefonsamtalet forts√§tter direkt efter verifieringen. AI-agenten s√§ger: "Thank you for verifying. Now, let's get to know you. Answer naturally, and I'll guide you through some questions to understand you better."
*   Agenten st√§ller cirka 10 personliga fr√•gor. Dessa baseras p√• anv√§ndarens astrologiska data men presenteras som neutrala p√•st√•enden eller fr√•gor (t.ex. "St√§mmer det att du k√§nner dig trygg i bekanta milj√∂er, eller f√∂redrar du att utforska nya platser?").
*   Dynamiska f√∂ljdfr√•gor kan st√§llas baserat p√• anv√§ndarens svar.
*   Specifika fr√•gor st√§lls ocks√• f√∂r att bed√∂ma:
    *   **Spirituell erfarenhet:** (t.ex. "Praktiserar du meditation eller breathwork regelbundet?")
    *   **Niv√• av uppvaknande:** (t.ex. "K√§nner du att du har en djup f√∂rst√•else f√∂r dig sj√§lv och din plats i v√§rlden?")
*   Efter varje svar ger agenten en kort bekr√§ftelse (t.ex. "Interesting, thank you.").
*   Webbsidan uppdateras inte med fr√•gor/svar under samtalet (endast statusindikatorn syns). Svaren transkriberas i bakgrunden.
*   N√§r AI-agenten har samlat in tillr√§ckligt med data, avslutar den samtalet: "Thank you for sharing, it's exactly like I thought. Are you ready for your first activation? I'll send it to your screen now. I wish you the best journey, good luck and goodbye."
*   Samtidigt som agenten s√§ger detta, laddas det f√∂rsta uppdraget i bakgrunden, och webbsidan navigeras automatiskt till Steg 6 (`/activations`).

**üéØ Profileringens Syfte & M√•l:**

*   **Huvudsyfte:** Skapa en verifierad personlighetsprofil via en naturlig, talbaserad fr√•gestund f√∂r att kunna personifiera uppdrag, coaching och rekommendationer i InnerJourney. Identifiera √§ven tendenser relaterade till v√§lm√•ende och spirituell utvecklingsniv√•.
*   **Prim√§rt M√•l:** F√∂rst√• anv√§ndarens grundl√§ggande personlighetstyp, preferenser och emotionella tendenser.
*   **Sekund√§rt M√•l:** Identifiera eventuella tendenser f√∂r depression, sj√§lvmordstankar, ADHD, autism eller liknande f√∂r att kunna erbjuda l√§mpligt st√∂d (eller flagga f√∂r m√§nsklig uppf√∂ljning vid behov).
*   **Data att samla in:**
    *   Personlighetsdrag (t.ex. introvert/extrovert, intuitiv/analytisk).
    *   Uttalade preferenser (t.ex. `I prefer familiar settings`).
    *   V√§lm√•endemark√∂rer (t.ex. uttalanden som `I often feel hopeless`).
    *   Information om spirituell erfarenhet och uppvaknandeniv√•.
*   **Utv√§rdering:** En spr√•kmodell (t.ex. `BERT` eller `GPT`, finjusterad f√∂r uppgiften) analyserar den transkriberade texten fr√•n samtalet f√∂r att generera en strukturerad profil. Denna profil sparas i `Firestore` med f√§lt som `personalityType`, `neuroTendencies`, `wellbeingFlags`, `spiritualExperience`, `awakeningLevel`.
*   **Personifiering:** Den genererade profilen anv√§nds sedan f√∂r att:
    *   V√§lja relevanta **uppdrag** (t.ex. om anv√§ndaren √§r introvert -> rekommendera "The Sound of You"; om extrovert -> rekommendera "Tyst √ñgonkontakt Live").
    *   Anpassa **coaching** (t.ex. om `depressionRisk: true` -> matcha med en coach specialiserad p√• mental h√§lsa).
    *   Ge skr√§ddarsydda **rekommendationer** (t.ex. om `adhdScore: 8` -> f√∂resl√• korta, fokuserade mindfulness√∂vningar).

**üí° Tekniskt:**

*   **Frontend:**
    *   Routen `/profile-questions` renderar komponenten `ProfileQuestionsPage.tsx` (`React`, `TypeScript`, `Chakra UI`).
    *   Visar statusindikator ("Verification under progress..." -> "Call under progress...").
    *   *Alternativ 1 (Transkribering i Frontend):* Anv√§nder `Web Speech API` (eller liknande bibliotek) f√∂r att potentiellt f√•nga och transkribera anv√§ndarens svar lokalt.
    *   *Alternativ 2 (Transkribering i Backend/Dialogflow):* Frontend g√∂r ingenting aktivt med ljudet, utan f√∂rlitar sig p√• att backend/Dialogflow hanterar transkribering via telefonsamtalet. (Detta √§r mer troligt givet fl√∂det).
    *   Om svar skickas l√∂pande fr√•n Dialogflow till backend via webhook:
        ```http
        # Webhook fr√•n Dialogflow till Backend (exempel)
        POST /webhook/save-answer
        - Request Body: { session_id, question_id, transcript_segment, timestamp }
        ```
    *   N√§r backend signalerar att samtalet √§r avslutat och profileringen klar (t.ex. via `WebSocket` eller polling), g√∂r frontend ett API-anrop f√∂r att h√§mta f√∂rsta uppdraget:
        ```http
        GET /get-first-activation?session_id={session_id}
        ```
        (Se Steg 6 f√∂r detaljer om detta anrop).
    *   Efter att ha mottagit svar fr√•n `/get-first-activation`, sker automatisk navigering till `/activations` (Steg 6).

*   **Backend:**
    *   Genererar en dynamisk prompt f√∂r `Dialogflow CX` baserad p√• anv√§ndarens `VedAstro`-data (h√§mtad i Steg 4). Prompten inneh√•ller de initiala fr√•gorna och logik f√∂r f√∂ljdfr√•gor.
    *   Webhook Endpoint (t.ex. `/webhook/save-answer`): Tar emot transkriberade svar fr√•n `Dialogflow CX`, ackumulerar dem och sparar dem (eventuellt) i `Firestore` under `users/{session_id}/answers`.
    *   Efter att `Dialogflow CX` signalerar att alla fr√•gor √§r besvarade:
        1.  Initierar analys av den samlade transkriptionen med en spr√•kmodell (`BERT`/`GPT`).
        2.  Genererar den strukturerade anv√§ndarprofilen.
        3.  Sparar profilen i `Firestore` under `users/{session_id}` (uppdaterar befintligt dokument med f√§lt som `personalityType`, `neuroTendencies`, etc.).
    *   Endpoint `/get-first-activation`: Anv√§nds av frontend f√∂r att h√§mta det f√∂rsta uppdraget. Logiken v√§ljer ett uppdrag baserat p√• den nyss genererade profilen i `Firestore`.

*   **Firebase:** Anv√§ndarens transkriberade svar och den genererade profilen lagras i `Firestore` under `users/{session_id}`.
*   **Dialogflow CX:** Hanterar samtalsfl√∂det. St√§ller fr√•gor baserat p√• den dynamiska prompten fr√•n backend. F√•ngar anv√§ndarens svar, hanterar transkribering och skickar data (transkription, samtalsstatus) till backend via webhooks.

### Steg 6: F√∂rsta Uppdraget och Start p√• Resan üå±

**üë§ Anv√§ndarupplevelse:**

*   Direkt efter att AI-agenten avslutat samtalet i Steg 5, navigeras anv√§ndarens webbl√§sare automatiskt till sidan `/activations`.
*   Det f√∂rsta anpassade uppdraget visas p√• sk√§rmen. (Initialt, under utveckling/testning, kan detta vara ett fast uppdrag som "The Sound of You" f√∂r alla).
*   Exempel p√• visning:
    *   **Titel:** "Your First Task: The Sound of You"
    *   **Beskrivning:** "A reflective exercise to connect with your inner self through sound and mindfulness."
    *   **Knapp:** "Start Now" (med accentf√§rg `#00A676`).
*   Ett klick p√• knappen "Start Now" initierar sj√§lva uppdraget (visar uppdragsinstruktioner, startar eventuell timer eller mediespelare etc.).

**üí° Tekniskt:**

*   **Frontend:**
    *   API-anropet till `/get-first-activation` (triggat i slutet av Steg 5) returnerar uppdragsdetaljer:
        ```json
        // GET /get-first-activation?session_id={session_id} Response Body
        {
          "id": "sound-of-you",
          "title": "The Sound of You",
          "description": "A reflective exercise to connect with your inner self through sound and mindfulness.",
          // ... andra uppdragsdetaljer
        }
        ```
    *   Routen `/activations` renderar komponenten `ActivationsPage.tsx` (`React`, `TypeScript`, `Chakra UI`).
    *   Visar titel, beskrivning och "Start Now"-knapp baserat p√• data fr√•n API-anropet.
    *   Vid klick p√• "Start Now":
        *   Navigerar till en specifik uppdragsvy (t.ex. `/activations/sound-of-you`).
        *   Komponenten f√∂r det specifika uppdraget renderas.
        *   Ett API-anrop kan g√∂ras f√∂r att markera uppdraget som p√•b√∂rjat, t.ex. `POST /mark-activation-started`.

*   **Backend:**
    *   Endpoint `/get-first-activation`: H√§mtar anv√§ndarens profil fr√•n `Firestore`, v√§ljer ett l√§mpligt f√∂rsta uppdrag baserat p√• profilens data (eller returnerar standarduppdraget), och returnerar uppdragsinformationen.
    *   (Eventuell) Endpoint `/mark-activation-started`: Loggar att anv√§ndaren har p√•b√∂rjat ett specifikt uppdrag i `Firestore` (t.ex. i en `userActivations`-subsamling eller genom att uppdatera status i `users/{session_id}`).

*   **Firebase:** Anv√§ndarens framsteg och status f√∂r uppdrag sparas i `Firestore`, troligtvis under `users/{session_id}` eller en relaterad subsamling.

## üìö N√§sta Steg och Referenser

F√∂r planerade f√∂rb√§ttringar och vidare utveckling av onboarding-processen, se f√∂ljande dokument:

*   üîó `Backlog 4: 23 mars 2025`
*   üîó `Utvecklingsplan: Inner Journey`

F√∂r mer kontext och relaterad information om projektet och dess komponenter:

*   üîó `Onboarding-vision` (Den √∂vergripande visionen, mindre teknisk)
*   üîó `Onboarding-process` (En mellanliggande, mer processorienterad √∂versikt)
*   üîó `Projektbeskrivning: Inner Journey` (√ñvergripande projektinformation)
*   üîó `Teknisk dokumentation f√∂r backend` (Detaljer om backend-arkitektur och API:er)
*   üîó `Teknisk dokumentation f√∂r frontend` (Detaljer om frontend-arkitektur och komponenter)
*   üîó `Databasstruktur` (Beskrivning av Firestore-datamodellen, se `databasstruktur.md`)